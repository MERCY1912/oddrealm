# Документация проекта "Кровавые Арены"

## Общее описание

"Кровавые Арены" - это браузерная онлайн-игра в жанре RPG с элементами PvP и PvE боев. Проект представляет собой веб-приложение, разработанное с использованием современных технологий, которое позволяет игрокам создавать персонажей, сражаться с ботами или другими игроками, улучшать экипировку и развивать своих героев в средневековом фэнтезийном мире.

## Технологический стек

### Фронтенд
- **React 18.3.1** - основная библиотека для построения пользовательского интерфейса
- **TypeScript** - статическая типизация для JavaScript
- **Vite** - инструмент для сборки проекта и разработки
- **Tailwind CSS** - CSS-фреймворк для стилизации
- **Radix UI** - набор компонентов для создания доступных интерфейсов
- **React Router** - маршрутизация в приложении
- **React Query** - управление состоянием и кэширование данных
- **React Hook Form** - управление формами
- **Zod** - валидация данных

### Бэкенд
- **Supabase** - облачный бэкенд как сервис (BaaS), включающий:
  - Базу данных PostgreSQL
  - Аутентификацию пользователей
  - Realtime функциональность
  - Хранение файлов

### Дополнительные инструменты
- **ESLint** - линтинг кода
- **PostCSS** - обработка CSS
- **Autoprefixer** - автоматическое добавление вендорных префиксов

## Архитектура проекта

### Структура директорий

```
src/
├── components/          # React-компоненты
│   ├── ui/             # Базовые UI-компоненты (Radix UI)
│   ├── locations/      # Компоненты локаций (Арена, Город и т.д.)
│   └── admin/          # Компоненты административной панели
├── data/               # Статические данные игры (боты, предметы и т.д.)
├── hooks/              # Пользовательские React-хуки
├── integrations/       # Интеграции с внешними сервисами (Supabase)
├── lib/                # Вспомогательные утилиты
├── pages/              # Компоненты страниц
├── types/              # TypeScript-типы
├── utils/              # Утилиты для бизнес-логики
└── assets/             # Статические ресурсы (изображения)
```

### Ключевые компоненты архитектуры

#### 1. Система аутентификации
- Использует Supabase Auth для регистрации и входа пользователей
- Поддерживает автоматическое обновление токенов
- Сохранение сессии в localStorage

#### 2. Управление состоянием
- **React Query** - для управления серверным состоянием и кэширования
- **Локальное состояние** - React useState и useContext для управления состоянием компонентов
- **Хуки** - пользовательские хуки для инкапсуляции логики (например, useBattleState)

#### 3. Маршрутизация
- **React Router** - для навигации между страницами
- Основные маршруты:
  - `/` - главная страница (игровой интерфейс)
  - `/character-view` - просмотр персонажа
  - `/inventory-demo` - демонстрация инвентаря
  - и другие демонстрационные страницы

## Игровые механики

### 1. Система персонажей

#### Классы персонажей
- **Воин (Warrior)** - высокий показатель здоровья и защиты
- **Маг (Mage)** - высокая мана и магическая атака
- **Лучник (Archer)** - сбалансированные характеристики с уклоном в ловкость

#### Характеристики персонажа
- **Сила (Strength)** - влияет на атаку и защиту
- **Ловкость (Dexterity)** - влияет на шанс уклонения и критический удар
- **Удача (Luck)** - влияет на различные игровые механики
- **Выносливость (Endurance)** - влияет на здоровье
- **Магия (Magic)** - влияет на ману и магическую атаку

#### Прогрессия персонажа
- **Уровни (Levels)** - растут с получением опыта
- **Опыт (Experience)** - начисляется за победы в боях
- **Очки характеристик** - можно распределять при повышении уровня

### 2. Боевая система

#### PvE бои
- Бои с ботами разной сложности
- **Залы арены**:
  - Зал новичков (легкие противники)
  - Зал ветеранов (средние противники)
  - Зал легенд (сложные противники)
- **Механика боя**:
  - Выбор зоны атаки (голова, грудь, живот, пах, ноги)
  - Выбор зоны защиты
  - Учет шанса критического удара и уклонения

#### PvP бои
- Сражения между реальными игроками
- Система запросов на бой
- Рейтинговая система
- Награды за победы

#### Логика боя
- Пошаговая система с элементами реального времени
- Учет экипировки и характеристик
- Визуализация лога боя
- Анимации ударов и специальных эффектов

### 3. Система экипировки

#### Типы экипировки
- **Оружие** (Weapon) - мечи, посохи, луки и т.д.
- **Броня** (Armor) - основные доспехи
- **Шлемы** (Helmet) - защита головы
- **Сапоги** (Boots) - защита ног
- **Перчатки** (Gloves) - защита рук
- **Пояс** (Belt) - дополнительный слот
- **Ожерелье** (Necklace) - амулеты
- **Кольца** (Ring) - до 3 колец
- **Щит** (Shield) - дополнительная защита
- **Поножи** (Leggings) - защита ног
- **Наручи** (Bracers) - защита рук
- **Серьги** (Earring) - дополнительные аксессуары

#### Редкость предметов
- **Обычное** (Common) - базовые предметы
- **Редкое** (Rare) - улучшенные характеристики
- **Эпическое** (Epic) - мощные предметы
- **Легендарное** (Legendary) - уникальные предметы с высокими характеристиками

#### Характеристики предметов
- **Атака** (Attack) - увеличивает урон
- **Защита** (Defense) - уменьшает получаемый урон
- **Здоровье** (Health) - увеличивает максимальное здоровье
- **Мана** (Mana) - увеличивает максимальную ману
- **Шанс критического удара** (Critical Chance)
- **Шанс уклонения** (Dodge Chance)
- **Вампиризм** (Vampirism) - восстановление здоровья при атаке
- **Шанс блока** (Block Chance) - шанс заблокировать атаку

### 4. Экономика

#### Валюта
- **Золото (Gold)** - основная валюта в игре
- **Источники получения**:
  - Победы в боях
  - Продажа предметов
  - Выполнение квестов

#### Торговая система
- **Магазин** - покупка предметов за золото
- **Продажа экипировки** - продажа ненужных предметов за 50% от стоимости
- **Ценообразование** зависит от редкости и характеристик предмета

### 5. Локации

#### Город (City)
- **Кузница** - улучшение экипировки
- **Магазин** - покупка и продажа предметов
- **Таверна** - отдых и получение квестов
- **PvP Арена** - сражения с другими игроками
- **Лес** - охота на монстров
- **Подземелье** - опасные подземные лабиринты
- **Гильдия** - вступление в гильдии
- **Банк** - хранение золота и предметов

#### Арена (Arena)
- **Залы разного уровня сложности**
- **Бои с ботами-гладиаторами**
- **Получение опыта и золота за победы**

#### Лечебница (Infirmary)
- **Восстановление здоровья** за золото
- **Лечение персонажа после боев

## База данных

### Основные таблицы (Supabase)

#### profiles
- Хранит данные профиля игрока
- Поля: id, username, character_class, level, experience, health, mana и др.

#### equipment
- Экипировка игроков
- Поля: id, player_id, slot, item_data, item_id

#### player_inventory
- Инвентарь игроков
- Поля: id, player_id, item_id, item_data, quantity

#### admin_bots
- Боты для PvE боев
- Поля: id, name, level, health, attack, defense, difficulty и др.

#### admin_shop_items
- Предметы в магазине
- Поля: id, name, type, rarity, price, stats и др.

#### chat_messages
- Сообщения в чате
- Поля: id, player_id, player_name, message, created_at

#### user_activity
- Активность пользователей
- Поля: id, user_id, last_seen, created_at

### Связи между таблицами
- profiles -> equipment (один-ко-многим)
- profiles -> player_inventory (один-ко-многим)
- profiles -> chat_messages (один-ко-многим)

## API и интеграции

### Supabase Client
- Настроен в `src/integrations/supabase/client.ts`
- Использует localStorage для хранения сессии
- Автоматическое обновление токенов

### Запросы к данным
- **React Query** для кэширования и управления состоянием
- Realtime подписки для обновления данных в реальном времени
- Обработка ошибок и состояний загрузки

## Пользовательский интерфейс

### Дизайн
- **Средневековая тематика** с темными цветами
- **Градиентные эффекты** для заголовков и важных элементов
- **Анимированные элементы** для улучшения пользовательского опыта
- **Адаптивный дизайн** для разных размеров экранов

### Ключевые компоненты UI

#### Игровой интерфейс (GameInterface)
- Центральный компонент, объединяющий все элементы игры
- Управление локациями и навигацией
- Панель персонажа с характеристиками
- Чат и список онлайн-игроков

#### Панель персонажа (CharacterPanel)
- Отображение характеристик персонажа
- Управление распределением очков характеристик
- Визуализация прогресса (здоровье, мана, опыт)

#### Панель экипировки (CharacterEquipmentPanel)
- Визуализация экипированных предметов
- Интерактивные слоты для экипировки
- Отображение изображения персонажа

#### Инвентарь (InventoryPanel)
- Сетка слотов для хранения предметов
- Drag-and-drop для перемещения предметов
- Визуализация редкости предметов

#### Боевой интерфейс (BattleInterface)
- Панели игрока и противника
- Выбор зон атаки и защиты
- Лог боя с детальной информацией

## Разработка и развертывание

### Локальная разработка
```bash
# Установка зависимостей
npm install

# Запуск сервера разработки
npm run dev

# Сборка проекта
npm run build

# Линтинг кода
npm lint
```

### Переменные окружения
- `.env` - локальные переменные окружения
- `env.local` - переменные для продакшн-сборки

### Сборка и деплой
- **Vite** для быстрой сборки проекта
- **Lovable** интеграция для развертывания (указано в README.md)
- Поддержка различных окружений (разработка, продакшн)

## Будущие улучшения

### Планируемые функции
1. **Система квестов** - storyline и побочные задания
2. **Гильдии** - объединение игроков в группы
3. **PvP турниры** - соревнования между игроками
4. **Дополнительные локации** - новые зоны для исследования
5. **Система крафта** - создание предметов из ресурсов
6. **Аукцион** - торговля предметами между игроками

### Технические улучшения
1. **Оптимизация производительности** - lazy loading, мемоизация
2. **Улучшение анимаций** - более плавные переходы
3. **Мобильная версия** - адаптация для мобильных устройств
4. **Тестирование** - добавление unit и e2e тестов
5. **Безопасность** - улучшение защиты от читерства

## Заключение

"Кровавые Арены" - это комплексное веб-приложение с богатым функционалом для RPG-игр. Проект использует современные технологии и архитектурные подходы, что обеспечивает хорошую масштабируемость и поддерживаемость. Игровые механики охватывают все основные аспекты RPG-игр: развитие персонажа, боевую систему, экономику и социальное взаимодействие между игроками.